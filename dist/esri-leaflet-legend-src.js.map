{"version":3,"sources":["../src/Util.js","../src/Services/MapService.js","../src/Tasks/Legend.js","../src/Layers/DynamicMapLayer.js","../src/Controls/Legend.js"],"names":[],"mappings":"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","file":"esri-leaflet-legend-src.js","sourcesContent":["/**\n * @example\n * <code>\n * L.esri.Util.queue(\n *   [1, 2, 3], [], function(curr, item, cb){\n *     setTimeout(function(){\n *       cb(null, curr.concat([item + 10]));\n *     }, 200);\n *   }, function(err, result) {\n *     console.log(result); // [11, 12, 13]\n * });\n * </code>\n * @param  {Array.<*>} values\n * @param  {*}         initial\n * @param  {Function}  fn       process item fn(memo, item, callback)\n * @param  {Function}  done     queue complete\n * @param  {*=}        context\n */\nEsriLeaflet.Util.reduce = function(values, initial, fn, cb, context) {\n  var curr = initial;\n\n  function next(index) {\n    var sync = true;\n    for (var i = index; i < values.length; i++) {\n      var done = false;\n      fn(curr, values[i], function(err, val) {\n        if (err) {\n          return cb.callback(context, err, curr);\n        }\n        done = true;\n        curr = val;\n        if (!sync) {\n          next(i + 1);\n        }\n      });\n      sync = done;\n      if (!sync) {\n        return;\n      }\n    }\n    cb.call(context, null, curr);\n  }\n\n  next(0);\n};\n","EsriLeaflet.Services.MapService.include({\n\n  legend: function(callback, context) {\n    return new EsriLeaflet.Tasks.Legend(this).run(callback, context);\n  }\n\n});\n","EsriLeaflet.Tasks.Legend = EsriLeaflet.Tasks.Task.extend({\n  path: 'legend',\n\n  params: {\n    f: 'json'\n  },\n\n  run: function(callback, context) {\n    if (this._service) {\n      return this._service.request(this.path, this.params, callback, context);\n    } else {\n      return this._request('request', this.path, this.params, callback, context);\n    }\n  }\n\n});\n\nEsriLeaflet.Tasks.legend = function(params) {\n  return new EsriLeaflet.Tasks.Legend(params);\n};\n","EsriLeaflet.Layers.DynamicMapLayer.include({\n\n  legend: function(callback, context) {\n    return this._service.legend(callback, context);\n  }\n\n});\n","EsriLeaflet.Controls.Legend = L.Control.extend({\n\n  initialize: function(layers, options) {\n    this._layers = L.Util.isArray(layers) ? layers : [layers];\n    L.Control.prototype.initialize.call(this, options);\n  },\n\n  onAdd: function(map) {\n    var container = L.DomUtil.create('div', 'leaflet-legend-control leaflet-bar');\n    L.DomEvent\n      .disableScrollPropagation(container)\n      .disableClickPropagation(container);\n\n    if (this._layers.length) {\n      this._load();\n    }\n    return container;\n  },\n\n  _load: function() {\n    L.esri.Util.reduce(this._layers, {\n      layers: []\n    }, function(curr, layer, cb) {\n      layer.legend(function(err, legend) {\n        if (err) {\n          return cb(err, curr);\n        }\n        curr.layers = curr.layers.concat(legend.layers);\n        cb(null, curr);\n      });\n    }, this._onLoad, this);\n  },\n\n  _onLoad: function(error, legend) {\n    if (!error) {\n      var html = '<ul>';\n      for (var i = 0, len = legend.layers.length; i < len; i++) {\n        html += '<li><strong>' + legend.layers[i].layerName + '</strong><ul>';\n        for (var j = 0, jj = legend.layers[i].legend.length; j < jj; j++) {\n          var layerLegend = legend.layers[i].legend[j];\n          this._validateLegendLabel(layerLegend);\n          html += L.Util.template(\n            '<li><img width=\"{width}\" height=\"{height}\" src=\"data:{contentType};base64,{imageData}\"><span>{label}</span></li>',\n            layerLegend);\n        }\n        html += '</ul></li>';\n      }\n      html += '</ul>';\n      this._container.innerHTML = html;\n    }\n  },\n\n  _validateLegendLabel: function(layerLegend) {\n    if (!layerLegend.label) {\n      layerLegend.label = '<all values>';\n    }\n    layerLegend.label = layerLegend.label.replace(/&/g, '&amp;')\n      .replace(/\"/g, '&quot;')\n      .replace(/'/g, '&#39;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;');\n  }\n\n});\n\nEsriLeaflet.Controls.legend = function(layers, options) {\n  return new L.esri.Controls.Legend(layers, options);\n};\n"]}